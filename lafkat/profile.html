<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lafkat â€“ Profil</title>
<meta name="theme-color" content="#FF7F2F" />
<style>
  :root{--orange:#FF7F2F;--orange-2:#ff9a58;--line:#ffd7bf;--ink:#1b1b1b}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--orange) 0%,var(--orange-2) 100%);color:var(--ink)}
  .header{background:#fff4ec;border-bottom:1px solid var(--line)}
  .header .inner{max-width:1000px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:10px}
  nav{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  nav a{text-decoration:none;color:#7a3b14;font-weight:700;font-size:14px;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
  nav a:hover{background:#ffefe4;border-color:#ffb98d}
  .wrap{max-width:1000px;margin:16px auto;padding:16px;display:grid;grid-template-columns:320px 1fr;gap:16px}
  @media (max-width:960px){.wrap{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px}
  .head{display:flex;align-items:center;gap:12px}
  .avatar{width:60px;height:60px;border-radius:50%;display:grid;place-items:center;
    background:radial-gradient(100% 100% at 30% 30%,#ffd18f,#ff7f2f);color:#fff;font-weight:900;font-size:22px}
  .muted{color:#7a3b14}
  .pill{display:inline-block;background:#ffe8d7;border:1px solid var(--line);padding:5px 10px;border-radius:999px;font-size:12px}
  .btn{cursor:pointer;border:none;background:#FF7F2F;color:#fff;padding:10px 14px;border-radius:10px;font-weight:800}
  .btn.secondary{background:#fff;color:#ff6a08;border:1.5px solid #ffd0b3}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .list{display:grid;gap:10px}
  .item{background:#fffdfb;border:1px solid var(--line);border-radius:12px;padding:10px}
  .meta{font-size:12px;color:#8b5a3a;display:flex;gap:10px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .empty{border:1px dashed #ffc49f;border-radius:10px;padding:12px;background:#fff7ef;color:#7a3b14}
  .rightHead{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-bottom:8px}
</style>
</head>
<body>
<header class="header">
  <div class="inner">
    <div style="width:40px;height:40px;border-radius:10px;background:radial-gradient(100% 100% at 30% 30%,#ffd18f,#ff7f2f);display:grid;place-items:center;color:#fff;font-weight:900">ğŸ’¬</div>
    <strong>Lafkat</strong>
    <nav>
      <a href="index-compact.html">BugÃ¼nÃ¼n CÃ¼mlesi</a>
      <a href="forum.html">Forum</a>
      <a href="leaderboard.html">Liderlik</a>
      <a href="friends.html">ArkadaÅŸlar</a>
      <a href="profile.html">Profil</a>
      <a href="settings.html">Ayarlar</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- Sol: profil bilgileri -->
  <aside class="card">
    <div class="head">
      <div class="avatar" id="avatar">ğŸ™‚</div>
      <div>
        <div style="font-weight:900" id="displayName">KullanÄ±cÄ±</div>
        <div class="muted" id="nickname">@takmaad</div>
        <div class="muted" id="email">ornek@posta.com</div>
      </div>
    </div>

    <div style="margin-top:10px" class="row">
      <span class="pill">Toplam Puan: <b id="pointsTotal">0</b></span>
      <span class="pill">HaftalÄ±k: <b id="pointsWeekly">0</b></span>
      <span class="pill">AylÄ±k: <b id="pointsMonthly">0</b></span>
    </div>

    <div style="margin-top:12px" class="row">
      <button class="btn secondary" id="btnEditName">AdÄ± DÃ¼zenle</button>
      <button class="btn secondary" id="btnLogout">Ã‡Ä±kÄ±ÅŸ Yap</button>
    </div>

    <div id="visitorNote" class="empty" style="display:none;margin-top:12px">
      ZiyaretÃ§i modundasÄ±nÄ±z. Profil dÃ¼zenlemek ve gÃ¶nderi eklemek iÃ§in giriÅŸ yapÄ±n.
    </div>
  </aside>

  <!-- SaÄŸ: gÃ¶nderilerim -->
  <section class="card">
    <div class="rightHead">
      <div>
        <div style="font-weight:900">GÃ¶nderilerim</div>
        <div class="muted" id="stats">0 gÃ¶nderi â€¢ 0 beÄŸeni</div>
      </div>
      <div class="row">
        <button class="btn secondary" id="btnRefresh">Yenile</button>
      </div>
    </div>
    <div id="posts" class="list"></div>
  </section>
</main>

<footer style="max-width:1000px;margin:0 auto 20px;padding:0 16px;color:#fff;opacity:.9">
  Â© Lafkat â€¢ â€œSÃ¶zcÃ¼kleri kat, eÄŸlenceyi yakala!â€
</footer>

<!-- Firebase (opsiyonel) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
/* ===== Ayarlar ===== */
let ENABLE_FIREBASE=false; // ğŸ”´ canlÄ±ya alÄ±rken true yap
const firebaseConfig={
  // apiKey:"...", authDomain:"...", projectId:"lafkat-23687"
};

const $=s=>document.querySelector(s);
function escapeHTML(s){return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]));}
function timeAgo(d){const s=(Date.now()-d)/1000;if(s<60)return"az Ã¶nce";const m=s/60;if(m<60)return`${Math.floor(m)} dk`;const h=m/60;if(h<24)return`${Math.floor(h)} sa`;return`${Math.floor(h/24)} g`;}
function firstLetters(name){const p=(name||"").trim().split(/\s+/); return (p[0]?.[0]||"")+(p[1]?.[0]||"");}

let db=null,auth=null,me=null,uid=null;
(function init(){
  if(firebaseConfig && firebaseConfig.projectId && ENABLE_FIREBASE){
    firebase.initializeApp(firebaseConfig); db=firebase.firestore(); auth=firebase.auth();
    auth.onAuthStateChanged(async user=>{
      if(!user){
        // ZiyaretÃ§i
        $("#visitorNote").style.display="block";
        me={displayName:"ZiyaretÃ§i", email:"", nickname:"ziyaretci"};
        renderProfile(me);
        renderPosts(DEMO_POSTS, true);
        return;
      }
      uid=user.uid;
      const userDoc = await db.collection("users").doc(uid).get();
      const data = userDoc.exists ? userDoc.data() : {};
      me = {
        displayName: user.displayName || data.displayName || "KullanÄ±cÄ±",
        email: user.email || data.email || "",
        nickname: data.nickname || (user.email? user.email.split("@")[0]:""),
        points: {
          total: data.totalPoints||0,
          weekly: data.weeklyPoints||0,
          monthly: data.monthlyPoints||0
        }
      };
      renderProfile(me);
      await loadMyPosts();
    });
  }else{
    // DEMO
    me={displayName:"Demo KullanÄ±cÄ±", email:"demo@lafkat.app", nickname:"democu", points:{total:120,weekly:35,monthly:90}};
    renderProfile(me);
    renderPosts(DEMO_POSTS, true);
  }
})();

/* ===== Profil render ===== */
function renderProfile(p){
  $("#displayName").textContent = p.displayName||"KullanÄ±cÄ±";
  $("#nickname").textContent = "@"+(p.nickname||"takmaad");
  $("#email").textContent = p.email||"";
  $("#pointsTotal").textContent = p.points?.total||0;
  $("#pointsWeekly").textContent = p.points?.weekly||0;
  $("#pointsMonthly").textContent = p.points?.monthly||0;
  $("#avatar").textContent = (firstLetters(p.displayName)||"ğŸ™‚").toUpperCase();
}

/* ===== GÃ¶nderilerim ===== */
let myPosts=[];
async function loadMyPosts(){
  if(!db||!uid) return;
  const snap = await db.collection("posts").where("uid","==", uid).orderBy("at","desc").limit(50).get();
  myPosts = snap.docs.map(d=>({ id:d.id, ...d.data(), at: d.data().at.toDate() }));
  renderPosts(myPosts);
}

function renderPosts(list, demo=false){
  const box=$("#posts"); box.innerHTML="";
  let totalLikes=0;
  if(!list.length){
    box.innerHTML = `<div class="empty">HenÃ¼z gÃ¶nderiniz yok. <a href="index-compact.html">BugÃ¼nÃ¼n CÃ¼mlesi</a> ile bir tane oluÅŸturun.</div>`;
  }else{
    list.forEach(p=>{
      totalLikes += (p.likes||0);
      const el=document.createElement("div");
      el.className="item";
      el.innerHTML=`
        <div style="font-weight:800">${escapeHTML(me.displayName)}</div>
        <div class="meta"><span>@${escapeHTML(me.nickname)}</span> â€¢ <span>ğŸ•’ ${timeAgo(new Date(p.at))}</span> â€¢ <span>ğŸ‘ ${p.likes||0}</span></div>
        <div style="margin:6px 0">${escapeHTML(p.text)}</div>
        <div class="actions">
          <button class="btn secondary" onclick="sharePost('${encodeURIComponent(p.text)}')">PaylaÅŸ</button>
          <button class="btn secondary" onclick="copyPost('${encodeURIComponent(p.text)}')">Kopyala</button>
          ${demo ? "" : `<button class="btn" onclick="deletePost('${p.id}')">Sil</button>`}
        </div>`;
      box.appendChild(el);
    });
  }
  $("#stats").textContent = `${list.length} gÃ¶nderi â€¢ ${totalLikes} beÄŸeni`;
}

/* ===== PaylaÅŸ / Kopyala ===== */
function sharePost(enc){
  const txt = decodeURIComponent(enc);
  const shareText = `${txt}\n\nLafkat â€¢ #SendeKatÄ±l\n${location.origin}${location.pathname}`;
  if(navigator.share){ navigator.share({title:"Lafkat", text:shareText}).catch(()=>{}); }
  else { copyPost(enc); }
}
async function copyPost(enc){
  const txt = decodeURIComponent(enc);
  const copy = `${txt}\n\nLafkat â€¢ #SendeKatÄ±l`;
  try{ await navigator.clipboard.writeText(copy); alert("KopyalandÄ±!"); }catch{ alert("Kopyalama baÅŸarÄ±sÄ±z."); }
}

/* ===== Silme ===== */
async function deletePost(postId){
  if(!db||!uid) return alert("GiriÅŸ yapmalÄ±sÄ±nÄ±z.");
  if(!confirm("Bu gÃ¶nderiyi silmek istediÄŸinizden emin misiniz?")) return;
  try{
    await db.collection("posts").doc(postId).delete();
    // listeden Ã§Ä±kar
    myPosts = myPosts.filter(p=>p.id!==postId);
    renderPosts(myPosts);
  }catch(e){
    alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z: " + (e?.message||""));
  }
}

/* ===== Ad dÃ¼zenleme ===== */
document.getElementById("btnEditName").addEventListener("click", async ()=>{
  const nv = prompt("Yeni adÄ±nÄ±zÄ± yazÄ±n:", me?.displayName||"");
  if(!nv) return;
  if(!db || !auth || !auth.currentUser){
    me.displayName = nv; renderProfile(me); return; // DEMO
  }
  try{
    await auth.currentUser.updateProfile({ displayName: nv });
    await db.collection("users").doc(auth.currentUser.uid).set({ displayName: nv }, { merge:true });
    me.displayName = nv; renderProfile(me);
    alert("GÃ¼ncellendi.");
  }catch(e){ alert("GÃ¼ncellenemedi: " + (e?.message||"")); }
});

/* ===== Ã‡Ä±kÄ±ÅŸ ===== */
document.getElementById("btnLogout").addEventListener("click", async ()=>{
  if(!auth){ alert("Demo mod: Ã§Ä±kÄ±ÅŸ yok."); return; }
  try{
    await auth.signOut();
    localStorage.removeItem("authRole"); localStorage.removeItem("authUser");
    location.href = "login.html";
  }catch(e){ alert("Ã‡Ä±kÄ±ÅŸ baÅŸarÄ±sÄ±z: " + (e?.message||"")); }
});

/* ===== Yenile ===== */
document.getElementById("btnRefresh").addEventListener("click", async ()=>{
  if(!db||!uid){ renderPosts(DEMO_POSTS,true); return; }
  await loadMyPosts();
});

/* ===== Demo verisi ===== */
const DEMO_POSTS=[
  { id:"d1", text:"BugÃ¼n iÅŸe giderken dondurma yÃ¼zÃ¼nden geciktim.", likes:5, at:new Date(Date.now()-3*60*60*1000) },
  { id:"d2", text:"BugÃ¼n iÅŸe giderken kediyi sevmek yÃ¼zÃ¼nden geciktim.", likes:2, at:new Date(Date.now()-6*60*60*1000) }
];
</script>
</body>
</html>
