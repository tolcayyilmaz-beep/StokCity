<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lafkat – Liderlik Tablosu</title>
<meta name="theme-color" content="#FF7F2F" />
<style>
  :root{--orange:#FF7F2F;--orange-2:#ff9a58;--ink:#1b1b1b;--line:#ffd7bf}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--orange) 0%,var(--orange-2) 100%);color:var(--ink)}
  .header{background:#fff4ec;border-bottom:1px solid var(--line)}
  .header .inner{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:10px}
  nav{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  nav a{text-decoration:none;color:#7a3b14;font-weight:700;font-size:14px;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
  nav a:hover{background:#ffefe4;border-color:#ffb98d}
  .wrap{max-width:1100px;margin:16px auto;padding:16px;background:#fff;border:1px solid var(--line);border-radius:14px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .tab{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
  .tab.active{background:#fff7ef;border-color:#ffb98d;color:#7a3b14}
  .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
  .search{flex:1;min-width:220px;padding:10px;border:1.5px solid #ffd0b3;border-radius:10px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #ffe1ce;text-align:left;font-size:14px}
  th{color:#7a3b14;font-weight:900;background:#fff9f4}
  .rank{font-weight:900;width:56px}
  .name{font-weight:800}
  .pill{display:inline-block;background:#ffe8d7;border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px}
  .muted{color:#8b5a3a;font-size:12px}
  .empty{margin-top:8px;border:1px dashed #ffc49f;border-radius:10px;padding:12px;background:#fff7ef;color:#7a3b14}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
</style>
</head>
<body>
<header class="header">
  <div class="inner">
    <div style="width:40px;height:40px;border-radius:10px;background:radial-gradient(100% 100% at 30% 30%,#ffd18f,#ff7f2f);display:grid;place-items:center;color:#fff;font-weight:900">💬</div>
    <strong>Lafkat</strong>
    <nav>
      <a href="index-compact.html">Bugünün Cümlesi</a>
      <a href="forum.html">Forum</a>
      <a href="leaderboard.html">Liderlik</a>
      <a href="friends.html">Arkadaşlar</a>
      <a href="profile.html">Profil</a>
      <a href="settings.html">Ayarlar</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="tabs">
    <button class="tab active" data-period="daily">Günlük</button>
    <button class="tab" data-period="weekly">Haftalık</button>
    <button class="tab" data-period="monthly">Aylık</button>
    <button class="tab" data-period="all">Genel</button>
  </div>

  <div class="bar">
    <input id="q" class="search" placeholder="İsim veya kullanıcı adı ile ara…" />
    <span class="pill" id="count">0 kişi</span>
    <span class="muted" id="modeTag">demo (offline)</span>
  </div>

  <div class="legend">
    <span class="pill">🏆 Puan</span>
    <span class="pill">📝 Gönderi</span>
    <span class="pill">👍 Beğeni</span>
  </div>

  <div class="tableWrap" style="overflow:auto;margin-top:8px">
    <table id="tbl">
      <thead>
        <tr>
          <th class="rank">Sıra</th>
          <th>Kullanıcı</th>
          <th>🏆 Puan</th>
          <th>📝 Gönderi</th>
          <th>👍 Beğeni</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <div id="empty" class="empty" style="display:none">Kayıt bulunamadı.</div>
</main>

<footer style="max-width:1100px;margin:0 auto 20px;padding:0 16px;color:#fff;opacity:.9">
  © Lafkat • “Sözcükleri kat, eğlenceyi yakala!”
</footer>

<!-- Firebase (opsiyonel) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
/* ===== Ayarlar ===== */
let ENABLE_FIREBASE=false; // canlıya alırken true
const firebaseConfig={
  // apiKey:"...", authDomain:"...", projectId:"lafkat-23687"
};

const $=s=>document.querySelector(s);
function escapeHTML(s){return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]));}
function todayId(){const t=new Date();const y=t.getFullYear(),m=String(t.getMonth()+1).padStart(2,'0'),d=String(t.getDate()).padStart(2,'0');return `${y}-${m}-${d}`;}

let db=null;
let PERIOD="daily"; // daily | weekly | monthly | all
let RAW=[]; // {displayName,nickname,points,posts,likes}

/* ===== Init ===== */
(function init(){
  if(firebaseConfig && firebaseConfig.projectId && ENABLE_FIREBASE){
    firebase.initializeApp(firebaseConfig); db=firebase.firestore();
    $("#modeTag").textContent="canlı (Firebase)";
  }
  bind();
  load();
})();

/* ===== UI events ===== */
function bind(){
  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", async ()=>{
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      t.classList.add("active");
      PERIOD = t.getAttribute("data-period");
      await load();
    });
  });
  $("#q").addEventListener("input", render);
}

/* ===== Data loaders ===== */
async function load(){
  RAW = [];
  if(!db){ RAW = demoData(PERIOD); render(); return; }

  if(PERIOD==="daily"){
    // Bugün post atanları topla: gönderi sayısı ve (varsa) beğeni alanı
    const snap = await db.collection("posts")
      .where("promptDate","==", todayId())
      .get();
    const map = new Map(); // uid -> {displayName,nickname,posts,likes}
    snap.forEach(d=>{
      const p=d.data(); const key=p.uid||"anon";
      if(!map.has(key)) map.set(key,{displayName:p.name||"Kullanıcı", nickname:(p.name||"").toLowerCase().replace(/\s+/g,""), posts:0, likes:0});
      const row=map.get(key);
      row.posts += 1;
      row.likes += (p.likes||0); // not: likes alanı CF ile güncelleniyorsa işler
    });
    RAW = Array.from(map.values()).map(r=>({
      displayName:r.displayName, nickname:r.nickname, points:(r.likes*2 + r.posts), posts:r.posts, likes:r.likes
    }));
    RAW.sort((a,b)=> b.points - a.points || b.likes - a.likes || b.posts - a.posts);
    render();
    return;
  }

  // Haftalık / Aylık / Genel: users koleksiyonundan
  const field = PERIOD==="weekly" ? "weeklyPoints" : PERIOD==="monthly" ? "monthlyPoints" : "totalPoints";
  const snap = await db.collection("users").orderBy(field,"desc").limit(50).get();
  RAW = snap.docs.map(d=>{
    const u=d.data();
    return {
      displayName: u.displayName || "Kullanıcı",
      nickname: u.nickname || (u.email? u.email.split("@")[0]:""),
      points: u[field] || 0,
      posts: u.postsCount || 0,      // ileride CF ile doldurulabilir
      likes: u.likesCount || 0       // ileride CF ile doldurulabilir
    };
  });
  render();
}

/* ===== Render ===== */
function render(){
  const q = ($("#q").value || "").trim().toLowerCase();
  const rows = RAW.filter(r=>{
    if(!q) return true;
    return (r.displayName||"").toLowerCase().includes(q) || (r.nickname||"").toLowerCase().includes(q);
  });

  $("#count").textContent = `${rows.length} kişi`;
  const tb=$("#tbody"); tb.innerHTML="";
  if(rows.length===0){ $("#empty").style.display="block"; return; }
  $("#empty").style.display="none";

  rows.slice(0,50).forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td class="rank">#${i+1}</td>
      <td class="name">${escapeHTML(r.displayName)} <span class="muted">@${escapeHTML(r.nickname||"")}</span></td>
      <td><span class="pill">${r.points||0}</span></td>
      <td>${r.posts||0}</td>
      <td>${r.likes||0}</td>
    `;
    tb.appendChild(tr);
  });
}

/* ===== Demo data ===== */
function demoData(period){
  const baseUsers=[
    {displayName:"Mina R.", nickname:"mina", total:320, monthly:120, weekly:45, posts:23, likes:88},
    {displayName:"Zeynep A.", nickname:"zeynep", total:270, monthly:90, weekly:42, posts:17, likes:74},
    {displayName:"Ayşe K.", nickname:"ayse", total:210, monthly:70, weekly:30, posts:15, likes:55},
    {displayName:"Hakan D.", nickname:"hakan", total:190, monthly:65, weekly:22, posts:12, likes:49},
    {displayName:"Kerem B.", nickname:"kerem", total:140, monthly:40, weekly:12, posts:9, likes:31}
  ];
  if(period==="daily"){
    // puan = likes*2 + posts
    return baseUsers.map(u=>({displayName:u.displayName,nickname:u.nickname,points:u.likes*2 + Math.max(1,Math.round(u.posts/5)),posts:Math.max(1,Math.round(u.posts/5)),likes:Math.round(u.likes/6)}))
                    .sort((a,b)=> b.points-a.points);
  }
  if(period==="weekly"){
    return baseUsers.map(u=>({displayName:u.displayName,nickname:u.nickname,points:u.weekly,posts:Math.max(1,Math.round(u.posts/3)),likes:Math.round(u.likes/4)}));
  }
  if(period==="monthly"){
    return baseUsers.map(u=>({displayName:u.displayName,nickname:u.nickname,points:u.monthly,posts:Math.max(1,Math.round(u.posts/2)),likes:Math.round(u.likes/2)}));
  }
  return baseUsers.map(u=>({displayName:u.displayName,nickname:u.nickname,points:u.total,posts:u.posts,likes:u.likes}));
}
</script>
</body>
</html>
