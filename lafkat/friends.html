<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lafkat ‚Äì Arkada≈ülar</title>
<meta name="theme-color" content="#FF7F2F" />
<style>
  :root{--orange:#FF7F2F;--orange-2:#ff9a58;--line:#ffd7bf;--ink:#1b1b1b}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--orange) 0%,var(--orange-2) 100%);color:var(--ink)}
  .header{background:#fff4ec;border-bottom:1px solid var(--line)}
  .header .inner{max-width:1000px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:10px}
  nav{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  nav a{text-decoration:none;color:#7a3b14;font-weight:700;font-size:14px;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
  nav a:hover{background:#ffefe4;border-color:#ffb98d}
  .wrap{max-width:800px;margin:16px auto;padding:16px;background:#fff;border:1px solid var(--line);border-radius:14px}
  h1{margin-top:0;font-size:22px;color:#7a3b14}
  .row{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
  input{flex:1;padding:10px;border:1.5px solid #ffd0b3;border-radius:10px}
  .btn{cursor:pointer;border:none;background:#FF7F2F;color:#fff;padding:10px 14px;border-radius:10px;font-weight:700}
  .btn.secondary{background:#fff;color:#ff6a08;border:1.5px solid #ffd0b3}
  .list{display:grid;gap:10px}
  .item{border:1px solid var(--line);border-radius:10px;padding:10px;background:#fffdfb;display:flex;align-items:center;gap:8px}
  .name{font-weight:800}
  .status.online{color:green;font-weight:700}
  .status.offline{color:#a33;font-weight:700}
  .actions{margin-left:auto}
</style>
</head>
<body>
<header class="header">
  <div class="inner">
    <div style="width:40px;height:40px;border-radius:10px;background:radial-gradient(100% 100% at 30% 30%,#ffd18f,#ff7f2f);display:grid;place-items:center;color:#fff;font-weight:900">üí¨</div>
    <strong>Lafkat</strong>
    <nav>
      <a href="index-compact.html">Bug√ºn√ºn C√ºmlesi</a>
      <a href="forum.html">Forum</a>
      <a href="leaderboard.html">Liderlik</a>
      <a href="friends.html">Arkada≈ülar</a>
      <a href="profile.html">Profil</a>
      <a href="settings.html">Ayarlar</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <h1>Arkada≈ülarƒ±m</h1>
  <div class="row">
    <input id="nickInput" type="text" placeholder="Arkada≈ü kullanƒ±cƒ± adƒ±" />
    <button class="btn" id="btnAdd">Ekle</button>
  </div>
  <div id="msg" style="color:#a33;font-size:13px;margin-bottom:8px"></div>
  <div class="list" id="friends"></div>
</main>

<footer style="max-width:800px;margin:0 auto 20px;padding:0 16px;color:#fff;opacity:.9">
  ¬© Lafkat ‚Ä¢ ‚ÄúS√∂zc√ºkleri kat, eƒülenceyi yakala!‚Äù
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
let ENABLE_FIREBASE=true; // canlƒ±ya alƒ±rken true
const firebaseConfig = {
  apiKey: "AIzaSyB5VbgogKUo8RXeA8SUMUaHVbbblAg4gfE",
  authDomain: "lafkat-23687.firebaseapp.com",
  projectId: "lafkat-23687",
  storageBucket: "lafkat-23687.firebasestorage.app",
  messagingSenderId: "493504696765",
  appId: "1:493504696765:web:86bb6f7a28e403efc782d4"
};

const $=s=>document.querySelector(s);
let db=null,auth=null,uid=null;

(function init(){
  if(firebaseConfig && firebaseConfig.projectId && ENABLE_FIREBASE){
    firebase.initializeApp(firebaseConfig); db=firebase.firestore(); auth=firebase.auth();
    auth.onAuthStateChanged(user=>{ if(user){ uid=user.uid; loadFriends(); } });
  }else{
    // DEMO
    renderFriends([{nickname:"ayse",status:"online"},{nickname:"hakan",status:"offline"}]);
  }
})();

async function loadFriends(){
  if(!db||!uid) return;
  const snap=await db.collection("friends").doc(uid).collection("list").get();
  const list=snap.docs.map(d=>({nickname:d.id, ...d.data()}));
  renderFriends(list);
}

function renderFriends(list){
  const box=$("#friends"); box.innerHTML="";
  if(!list.length){ box.innerHTML="<div class='item'>Hen√ºz arkada≈ü yok</div>"; return;}
  list.forEach(f=>{
    const el=document.createElement("div");
    el.className="item";
    el.innerHTML=`<div class="name">@${f.nickname}</div>
      <div class="status ${f.status||'offline'}">${f.status||'offline'}</div>
      <div class="actions"><button class="btn secondary" onclick="removeFriend('${f.nickname}')">Sil</button></div>`;
    box.appendChild(el);
  });
}

$("#btnAdd").addEventListener("click", async ()=>{
  const nick=$("#nickInput").value.trim().toLowerCase();
  if(!nick) return;
  if(localStorage.getItem("authRole")==="visitor"){ return $("#msg").textContent="Ziyaret√ßi arkada≈ü ekleyemez."; }
  if(!db||!uid){ return $("#msg").textContent="Giri≈ü yapƒ±n."; }

  // profil var mƒ±?
  const prof=await db.collection("profiles").doc(nick).get();
  if(!prof.exists){ return $("#msg").textContent="B√∂yle bir kullanƒ±cƒ± yok."; }

  await db.collection("friends").doc(uid).collection("list").doc(nick).set({
    since: firebase.firestore.Timestamp.now(), status:"offline"
  });
  $("#msg").textContent=""; $("#nickInput").value="";
  loadFriends();
});

async function removeFriend(nick){
  if(!db||!uid) return;
  await db.collection("friends").doc(uid).collection("list").doc(nick).delete();
  loadFriends();
}
</script>
</body>
</html>
