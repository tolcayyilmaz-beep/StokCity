
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LafKat – Arkadaşlar</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <script src="assets/app.js"></script>
</head>
<body onload="initFriends()">
  
<div class="topbar">
  <div class="nav">
    <a class="brand brand-link" href="index.html" aria-label="LafKat">
      <img src="assets/logo.svg" alt="" style="width:28px;height:28px" />
      <span>LafKat</span>
    </a>
    <button class="hamburger btn small ghost" onclick="toggleMenu()">☰</button>
    <div class="menu">
      <a href="home.html" data-page="home">Anasayfa</a>
      <a href="forum.html" data-page="forum">Forum</a>
      <a href="leaderboard.html" data-page="leaderboard">Liderlik</a>
      <a href="friends.html" data-page="friends">Arkadaşlar</a>
      <a href="profile.html" data-page="profile">Profil</a>
      <a href="settings.html" data-page="settings">Ayarlar</a>
      <a href="admin.html" class="admin-link" data-page="admin">Admin</a>
      <a href="terms.html" data-page="terms">Şartlar</a>
      <a href="privacy.html" data-page="privacy">Gizlilik</a>
    </div>
    <div class="right">
      <span class="nickname show-when-auth"></span>
      <button class="btn small ghost show-when-auth" onclick="logout()">Oturumu Kapat</button>
      <a class="btn small hide-when-auth" href="index.html">Giriş</a>
      <button class="btn small ghost" onclick="toggleTheme()" title="Tema">🌓</button>
    </div>
  </div>
</div>

  <div class="container">
    <div class="row">
      <div class="card">
        <h3 class="title">Arkadaş Ekle</h3>
        <label>Nickname veya e-posta</label>
        <input class="input" id="friendInput" placeholder="ornek@posta.com veya @takmaad"/>
        <div class="flex" style="margin-top:8px">
          <button class="btn" onclick="sendRequest()">Gönder</button>
        </div>
        <p class="small-muted">Karşı taraf onayı ile arkadaş olursunuz.</p>
      </div>

      <div class="card">
        <h3 class="title">Arkadaşlık Teklifleri</h3>
        <div id="requests"></div>
      </div>
    </div>

    <div class="card">
      <h3 class="title">Arkadaşlar</h3>
      <table class="table" id="friendsTable">
        <thead><tr><th>Kullanıcı</th><th>Durum</th><th>İşlem</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <footer>© 2025 LafKat</footer>

<script>
function initFriends(){ initTopbar('friends'); renderRequests(); renderFriends(); }
function sendRequest(){
  const v = document.querySelector('#friendInput').value.trim();
  if(!v) return;
  addFriend(v);
  document.querySelector('#friendInput').value='';
  toast('Teklif gönderildi');
  renderRequests();
}
function renderRequests(){
  const F = JSON.parse(localStorage.getItem(LS.friends) || '{"requests":[],"list":[]}');
  const box = document.querySelector('#requests'); box.innerHTML='';
  F.requests.forEach((r, idx)=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `<div class="flex" style="justify-content:space-between">
      <div><b>@${r.to}</b> • <span class="badge">${r.status}</span></div>
      <div class="flex">
        <button class="btn small ghost" onclick="approve(${idx})">Onayla</button>
        <button class="btn small ghost" onclick="reject(${idx})">Reddet</button>
      </div>
    </div>`;
    box.appendChild(div);
  });
}
function approve(i){
  const F = JSON.parse(localStorage.getItem(LS.friends) || '{"requests":[],"list":[]}');
  const req = F.requests[i];
  F.list.push({nick:req.to, online: Math.random()>.5});
  F.requests.splice(i,1);
  localStorage.setItem(LS.friends, JSON.stringify(F));
  renderRequests(); renderFriends();
}
function reject(i){
  const F = JSON.parse(localStorage.getItem(LS.friends) || '{"requests":[],"list":[]}');
  F.requests.splice(i,1);
  localStorage.setItem(LS.friends, JSON.stringify(F));
  renderRequests();
}
function renderFriends(){
  const F = JSON.parse(localStorage.getItem(LS.friends) || '{"requests":[],"list":[]}');
  const tb = document.querySelector('#friendsTable tbody'); tb.innerHTML='';
  F.list.forEach((f, i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>@${f.nick}</td><td>${f.online?'🟢 Online':'⚪ Offline'}</td>
      <td><a class="btn small ghost" href="forum.html#dm">Mesaj</a> <button class="btn small ghost" onclick="rm(${i})">Çıkar</button></td>`;
    tb.appendChild(tr);
  });
}
function rm(i){
  const F = JSON.parse(localStorage.getItem(LS.friends) || '{"requests":[],"list":[]}');
  F.list.splice(i,1);
  localStorage.setItem(LS.friends, JSON.stringify(F));
  renderFriends();
}
</script>
</body>
</html>
