
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LafKat – Anasayfa</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <script src="assets/app.js"></script>
</head>
<body onload="initHome()">
  
<div class="topbar">
  <div class="nav">
    <a class="brand brand-link" href="index.html" aria-label="LafKat">
      <img src="assets/logo.svg" alt="" style="width:28px;height:28px" />
      <span>LafKat</span>
    </a>
    <button class="hamburger btn small ghost" onclick="toggleMenu()">☰</button>
    <div class="menu">
      <a href="home.html" data-page="home">Anasayfa</a>
      <a href="forum.html" data-page="forum">Forum</a>
      <a href="leaderboard.html" data-page="leaderboard">Liderlik</a>
      <a href="friends.html" data-page="friends">Arkadaşlar</a>
      <a href="profile.html" data-page="profile">Profil</a>
      <a href="settings.html" data-page="settings">Ayarlar</a>
      <a href="admin.html" class="admin-link" data-page="admin">Admin</a>
      <a href="terms.html" data-page="terms">Şartlar</a>
      <a href="privacy.html" data-page="privacy">Gizlilik</a>
    </div>
    <div class="right">
      <span class="nickname show-when-auth"></span>
      <button class="btn small ghost show-when-auth" onclick="logout()">Oturumu Kapat</button>
      <a class="btn small hide-when-auth" href="index.html">Giriş</a>
      <button class="btn small ghost" onclick="toggleTheme()" title="Tema">🌓</button>
    </div>
  </div>
</div>

  <div class="container">
    <div class="row">
      <div>
        <div class="card">
          <div class="kicker">Günün Cümlesi #1</div>
          <h2 class="title">Arkadaşım gizlice defterime bir şeyler yazmış. Sayfayı açtığımda kocaman <u>____</u> yazısını gördüm.</h2>
          <div class="subtle">Bugün 2 cümleden 1.si • Kalan hakkın: <span id="quota" class="counter"></span>/5</div>
          <hr/>
          <textarea id="completionText" rows="3" placeholder="Cümleyi yaratıcı şekilde tamamla..."></textarea>
          <div class="flex" style="justify-content:space-between;margin-top:8px">
            <button class="btn" onclick="submitCompletion()">Gönder</button>
            <button class="btn ghost" onclick="shareOrCopy('LafKat: Günün cümlesi – #SendeKatıl')">Paylaş/Kopyala</button>
          </div>
        </div>

        <div class="card">
          <div class="kicker">Akış</div>
          <h3 class="title">Son Gönderiler</h3>
          <div id="feed"></div>
        </div>
      </div>

      <div>
        <div class="card">
          <div class="kicker">Öne Çıkanlar</div>
          <h3 class="title">Bugünün İlk 3'ü</h3>
          <div id="top3" class="grid-1"></div>
        </div>
        <div class="card">
          <div class="kicker">Akış</div>
          <h3 class="title">Son 10 Gönderi</h3>
          <ol id="last10" style="margin:0;padding-left:18px"></ol>
        </div>
        <div class="card">
          <div class="kicker">Ödül</div>
          <h3 class="title">Haftanın Lafkatçısı</h3>
          <p class="subtle">Bu hafta en çok beğeni alan: <b>@zorba</b></p>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="commentModal">
    <div class="modal">
      <h3 class="title">Yorum Yap</h3>
      <textarea id="commentText" rows="3" placeholder="Yorumun..."></textarea>
      <div class="flex" style="justify-content:flex-end;margin-top:10px">
        <button class="btn ghost" onclick="closeComment()">İptal</button>
        <button class="btn" onclick="saveComment()">Gönder</button>
      </div>
    </div>
  </div>

  <footer>© 2025 LafKat</footer>

<script>
let currentCommentFor = null;
function initHome(){
  initTopbar('home');
  const t = getTokenInfo();
  document.querySelector('#quota').textContent = (t.limit - t.used);
  renderFeed();
  renderTop();
}
function submitCompletion(){
  const u = getUser();
  if(!u){ toast('Lütfen giriş yap'); return location.href='index.html'; }
  const text = document.querySelector('#completionText').value.trim();
  if(!text) return toast('Metin boş olamaz');
  if(!consumeToken()){ return toast('Günlük 5 gönderi hakkın doldu'); }
  addCompletion({
    id: 'c_' + Date.now(),
    promptId: 'p1',
    user: {uid:u.uid, nick:u.nickname},
    text,
    ts: Date.now(),
    likes:0, dislikes:0, votes: {}, comments: []
  });
  document.querySelector('#completionText').value = '';
  const t = getTokenInfo();
  document.querySelector('#quota').textContent = (t.limit - t.used);
  renderFeed(); renderTop();
  toast('Gönderildi');
}
function renderFeed(){
  const wrap = document.querySelector('#feed');
  const list = getCompletions();
  wrap.innerHTML = '';
  list.slice(0,20).forEach(item => {
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `
      <div class="flex" style="justify-content:space-between">
        <div><b>@${item.user.nick}</b> • <span class="subtle">${timeAgo(item.ts)}</span></div>
        <div class="flex">
          <button class="btn small ghost" onclick="vote('${item.id}','up');this.querySelector('span').textContent=parseInt(this.querySelector('span').textContent)+1">👍 <span>${item.likes||0}</span></button>
          <button class="btn small ghost" onclick="vote('${item.id}','down');this.querySelector('span').textContent=parseInt(this.querySelector('span').textContent)+1">👎 <span>${item.dislikes||0}</span></button>
        </div>
      </div>
      <p style="margin:10px 0">${item.text}</p>
      <div class="flex">
        <button class="btn small ghost" onclick="openComment('${item.id}')">Yorum</button>
        <button class="btn small ghost" onclick="shareOrCopy('LafKat: “'+ item.text + '” #SendeKatıl')">Paylaş/Kopyala</button>
      </div>
    `;
    wrap.appendChild(div);
  });
}
function vote(id, type){ voteCompletion(id, type); }
function renderTop(){
  const list = getCompletions().slice().sort((a,b)=> b.likes - a.likes).slice(0,3);
  const t = document.querySelector('#top3'); t.innerHTML='';
  list.forEach((x,i)=>{
    const c = document.createElement('div');
    c.className='card';
    c.innerHTML = `<div class="badge">#${i+1}</div><p style="margin:8px 0"><b>@${x.user.nick}</b>: ${x.text}</p><div class='subtle'>👍 ${x.likes||0} • 👎 ${x.dislikes||0}</div>`;
    t.appendChild(c);
  });
  const l10 = document.querySelector('#last10'); l10.innerHTML='';
  getCompletions().slice(0,10).forEach(x=>{
    const li = document.createElement('li');
    li.textContent = x.user.nick + ': ' + x.text;
    l10.appendChild(li);
  });
}
function openComment(id){ currentCommentFor = id; document.querySelector('#commentModal').classList.add('show'); }
function closeComment(){ document.querySelector('#commentModal').classList.remove('show'); currentCommentFor = null; }
function saveComment(){
  const txt = document.querySelector('#commentText').value.trim();
  if(!txt) return;
  const arr = getCompletions();
  const item = arr.find(x=> x.id===currentCommentFor);
  if(item){
    item.comments = item.comments || [];
    const u = getUser()||{nickname:'guest'};
    item.comments.push({nick:u.nickname, text:txt, ts: Date.now()});
    localStorage.setItem(LS.completions, JSON.stringify(arr));
    toast('Yorum eklendi');
  }
  document.querySelector('#commentText').value='';
  closeComment();
}
</script>
</body>
</html>
