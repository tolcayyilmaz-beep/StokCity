<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lafkat â€“ GiriÅŸ</title>
<meta name="theme-color" content="#FF7F2F" />
<style>
  :root{--orange:#FF7F2F;--orange-2:#ff9a58;--ink:#1b1b1b;--line:#ffd7bf}
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;display:grid;place-items:center;padding:24px;
    font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--orange) 0%,var(--orange-2) 100%);color:var(--ink)}
  .card{width:min(400px,100%);background:#fff;border:1px solid var(--line);border-radius:18px;
    box-shadow:0 18px 48px rgba(255,127,47,.28);padding:22px}
  .logo{width:56px;height:56px;border-radius:14px;background:radial-gradient(100% 100% at 30% 30%,#ffd18f,#ff7f2f);
    display:grid;place-items:center;color:#fff;font-weight:900;font-size:22px;box-shadow:0 10px 28px rgba(255,127,47,.35);margin:0 auto 12px}
  h1{text-align:center;margin:8px 0 20px;font-size:26px}
  label{font-weight:700;font-size:13px;color:#7a3b14}
  .row{display:grid;gap:10px;margin-top:10px}
  input{width:100%;padding:12px;border:1.6px solid #ffd0b3;border-radius:12px;font-size:15px;outline:none}
  input:focus{border-color:#ff9a58;box-shadow:0 0 0 4px #ffe7d7}
  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn{flex:1;cursor:pointer;border:none;background:#FF7F2F;color:#fff;padding:12px 16px;border-radius:12px;
    font-weight:800;box-shadow:0 10px 20px rgba(255,127,47,.35);text-align:center}
</style>
</head>
<body>
<div class="card">
  <div class="logo">ðŸ’¬</div>
  <h1>Lafkat</h1>
  <form id="form" class="row" autocomplete="on">
    <div class="row">
      <label for="idInput">E-posta veya KullanÄ±cÄ± AdÄ±</label>
      <input id="idInput" type="text" required />
    </div>
    <div class="row">
      <label for="password">Åžifre</label>
      <input id="password" type="password" required />
    </div>
    <div class="actions">
      <button class="btn" type="submit" id="btnLogin">GiriÅŸ Yap</button>
      <button class="btn" type="button" id="btnRegister">KayÄ±t Ol</button>
      <button class="btn" type="button" id="btnForgot">Åžifre SÄ±fÄ±rla</button>
      <button class="btn" type="button" id="btnGuest">ZiyaretÃ§i</button>
    </div>
  </form>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
let ENABLE_FIREBASE = true;
const firebaseConfig = {
  apiKey: "AIzaSyB5VbgogKUo8RXeA8SUMUaHVbbblAg4gfE",
  authDomain: "lafkat-23687.firebaseapp.com",
  projectId: "lafkat-23687",
  storageBucket: "lafkat-23687.firebasestorage.app",
  messagingSenderId: "493504696765",
  appId: "1:493504696765:web:86bb6f7a28e403efc782d4"
};

const PATH_AFTER_LOGIN = "index-compact.html";
const PATH_REGISTER = "register.html";

const $ = s=>document.querySelector(s);
function isEmail(v){ return /@/.test(v); }

let db=null, auth=null;
(function init(){
  if(firebaseConfig && firebaseConfig.projectId && ENABLE_FIREBASE){
    firebase.initializeApp(firebaseConfig);
    db=firebase.firestore(); auth=firebase.auth();
  }
})();

$("#btnRegister").addEventListener("click", ()=>{ window.location.href = PATH_REGISTER; });
$("#btnGuest").addEventListener("click", ()=>{
  localStorage.setItem("authRole","visitor");
  localStorage.removeItem("authUser");
  alert("ZiyaretÃ§i modundasÄ±nÄ±z.");
  setTimeout(()=>location.href=PATH_AFTER_LOGIN,600);
});
$("#btnForgot").addEventListener("click", async ()=>{
  const id=$("#idInput").value.trim();
  if(!ENABLE_FIREBASE){ return alert("Demo mod: ÅŸifre sÄ±fÄ±rlama yok."); }
  if(!id || !isEmail(id)) return alert("E-posta adresinizi yazÄ±n.");
  try{ await auth.sendPasswordResetEmail(id); alert("SÄ±fÄ±rlama e-postasÄ± gÃ¶nderildi."); }catch(e){ alert(e.message); }
});
$("#form").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const id=$("#idInput").value.trim(); const pass=$("#password").value;
  if(!ENABLE_FIREBASE){
    if(!id||!pass) return alert("Bilgileri doldurun.");
    localStorage.setItem("authRole","user");
    localStorage.setItem("authUser", JSON.stringify({id, nickname: id.includes("@")? id.split("@")[0]: id}));
    return location.href=PATH_AFTER_LOGIN;
  }
  try{
    let email=id;
    if(!isEmail(id)){
      const snap = await db.collection("users").where("nickname","==", id).limit(1).get();
      if(snap.empty) return alert("KullanÄ±cÄ± adÄ± bulunamadÄ±.");
      email = snap.docs[0].data().email;
    }
    const { user } = await auth.signInWithEmailAndPassword(email, pass);
    localStorage.setItem("authRole","user");
    localStorage.setItem("authUser", JSON.stringify({ uid:user.uid, email:user.email, displayName:user.displayName || "" }));
    location.href=PATH_AFTER_LOGIN;
  }catch(err){ alert(err.message); }
});
</script>
</body>
</html>
