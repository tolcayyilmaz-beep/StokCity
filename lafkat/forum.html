
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LafKat – Forum</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <script src="assets/app.js"></script>
</head>
<body onload="initForum()">
  
<div class="topbar">
  <div class="nav">
    <a class="brand brand-link" href="index.html" aria-label="LafKat">
      <img src="assets/logo.svg" alt="" style="width:28px;height:28px" />
      <span>LafKat</span>
    </a>
    <button class="hamburger btn small ghost" onclick="toggleMenu()">☰</button>
    <div class="menu">
      <a href="home.html" data-page="home">Anasayfa</a>
      <a href="forum.html" data-page="forum">Forum</a>
      <a href="leaderboard.html" data-page="leaderboard">Liderlik</a>
      <a href="friends.html" data-page="friends">Arkadaşlar</a>
      <a href="profile.html" data-page="profile">Profil</a>
      <a href="settings.html" data-page="settings">Ayarlar</a>
      <a href="admin.html" class="admin-link" data-page="admin">Admin</a>
      <a href="terms.html" data-page="terms">Şartlar</a>
      <a href="privacy.html" data-page="privacy">Gizlilik</a>
    </div>
    <div class="right">
      <span class="nickname show-when-auth"></span>
      <button class="btn small ghost show-when-auth" onclick="logout()">Oturumu Kapat</button>
      <a class="btn small hide-when-auth" href="index.html">Giriş</a>
      <button class="btn small ghost" onclick="toggleTheme()" title="Tema">🌓</button>
    </div>
  </div>
</div>

  <div class="container">
    <div class="card">
      <div class="tabs">
        <div class="tab active" id="tab-pop" onclick="switchTab('pop')">Popüler (Bugün)</div>
        <div class="tab" id="tab-new" onclick="switchTab('new')">En Yeni</div>
      </div>
      <div id="forumList"></div>
      <div style="text-align:center;margin-top:10px">
        <button class="btn ghost" onclick="loadMore()">Daha Fazla Yükle</button>
      </div>
    </div>

    <div class="card">
      <div class="kicker">Canlı Sohbet</div>
      <div class="chat" id="chatBox"></div>
      <div class="flex" style="margin-top:8px">
        <input class="input" id="chatInput" placeholder="Mesajınız..." onkeydown="if(event.key==='Enter') sendMsg()"/>
        <button class="btn" onclick="sendMsg()">Gönder</button>
      </div>
      <div class="small-muted">Mesajın başında nickname’in görünecek.</div>
    </div>
  </div>
  <footer>© 2025 LafKat</footer>

<script>
let forumPage=1, currentTab='pop';
function initForum(){ initTopbar('forum'); renderForum(); renderChat(); }
function switchTab(t){
  currentTab=t;
  document.querySelector('#tab-pop').classList.toggle('active', t==='pop');
  document.querySelector('#tab-new').classList.toggle('active', t==='new');
  forumPage=1; renderForum();
}
function renderForum(){
  const list = getCompletions();
  let arr = list.slice();
  if(currentTab==='pop') arr = arr.sort((a,b)=> b.likes - a.likes);
  else arr = arr.sort((a,b)=> b.ts - a.ts);
  const take = arr.slice(0, forumPage*10);
  const box = document.querySelector('#forumList'); box.innerHTML='';
  take.forEach(item=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `<div class="flex" style="justify-content:space-between">
      <div><b>@${item.user.nick}</b> • <span class="subtle">${timeAgo(item.ts)}</span></div>
      <div class="flex">
        <button class="btn small ghost" onclick="voteCompletion('${item.id}','up'); renderForum()">👍 ${item.likes||0}</button>
        <button class="btn small ghost" onclick="voteCompletion('${item.id}','down'); renderForum()">👎 ${item.dislikes||0}</button>
      </div>
    </div>
    <p style="margin:10px 0">${item.text}</p>`;
    box.appendChild(div);
  });
}
function loadMore(){ forumPage++; renderForum(); }
function renderChat(){
  const box = document.querySelector('#chatBox');
  box.innerHTML='';
  getChat().slice(-100).forEach(m=>{
    const d = document.createElement('div');
    d.className='msg';
    d.innerHTML = `<div><span class="nick">@${m.nick}</span> <time>• ${timeAgo(m.ts)}</time><div>${m.text}</div></div>`;
    box.appendChild(d);
  });
  box.scrollTop = box.scrollHeight;
}
function sendMsg(){
  const u = getUser();
  if(!u){ toast('Önce giriş yap'); return location.href='index.html'; }
  const t = document.querySelector('#chatInput').value.trim();
  if(!t) return;
  pushChat(u.nickname, t);
  document.querySelector('#chatInput').value='';
  renderChat();
}
</script>
</body>
</html>
